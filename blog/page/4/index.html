
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="windfire.cd">

  
  <meta name="description" content="来源 此项目最开始由Linkedln开发并开源的一个消息系统。Linkdeln将其作为
可读写的流以及服务状态的数据管道。对于一个网站来说，读写流
经常用来记录页面浏览信息，展示信息以及搜素信息，这些信息一般由日志
系统进行记录。服务状态包括当前机器的cpu, IO, 请求时间， 服务日志等。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://windfire-cd.github.com/blog/page/4/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>life and I</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:windfire-cd.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/09/apache-kafka-jie-shao/">Apache Kafka 介绍</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-09T18:20:00+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/09/apache-kafka-jie-shao/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>来源</h2>

<p>此项目最开始由Linkedln开发并开源的一个消息系统。Linkdeln将其作为
可读写的流以及服务状态的数据管道。对于一个网站来说，读写流
经常用来记录页面浏览信息，展示信息以及搜素信息，这些信息一般由日志
系统进行记录。服务状态包括当前机器的cpu, IO, 请求时间， 服务日志等。
近年来，服务状态日益成为衡量网站质量的标志。</p>

<h2>使用读写流以及服务状态的例子</h2>

<ul>
<li>消息广播(News feed) 朋友活动的广播</li>
<li>用户评分以及相关性计算</li>
<li>安全：需要可以进行监测恶意攻击，平衡集群负载等操作</li>
<li>监控</li>
<li>报表以及离线数据处理：hadoop</li>
</ul>


<h2>活跃数据特性</h2>

<p>大流量的数据活跃无法确定大小。传统的日志方式是一种离线的处理方式
比如离线的报告和压缩。对于实时系统，这种方式时延就泰高了。现有的消息队列系统
处理周期。kafka作为一个队列系统可以分别处理离线以及实时的问题。</p>

<h2>linkdedln的模块结构</h2>

<p><img src="http://incubator.apache.org/kafka/images/tracking_high_level.png"></p>

<p>一个kafka的队列系统可以对应于多个模块的数据处理。还可以利用其进行不同数据中心的
数据备份。</p>

<p>kafka集群并不是在数据中心中集中进行部署并提供服务，而是根据数据流拓扑部署多个
集群，不同集群间通过同步来进行数据流处理，其中镜像集群只是源集群的一个消费者。
下面的图示表示了这个过程</p>

<p><img src="http://incubator.apache.org/kafka/images/kafka_multidc.png"></p>

<h2>kafka设计</h2>

<ul>
<li>kafka为一般情况下的持久化消息队列系统</li>
<li>设计约束主要考量吞吐量而不是功能</li>
<li>消息处理模块记录所处理消息的状态，而不是消息提供模块</li>
<li>kafka被设计为分布式部署，其中消息的生产者，代理者和消费者可以分布于整个集群</li>
</ul>


<h3>基础</h3>

<p>消息是模块间通信的基础单元，消息被发布到代理不同主题的服务器上，某些消费模块
订阅该主题，那么所有被发布的消息都被订阅该主题的消费者收到。</p>

<p>kafka的分布式方案对于生产者和代理者来说比较明晰，但是对于消费者，需要一个特别的
设置和支持。消费者组的概念可以类似于JMS中的队列以及主题，这里的消费者组
可以作为一个逻辑上的单一消费者出现在集群中。对于队列，可以把所有的消费者
作为一个组，而将不同的消费者组成不同的组则对应了主题。一般的情况是根据
不同的主题分为不同的逻辑组，逻辑组作为一个单独的对象出现在集群中。kafka的一个
额外特性是在大量的数据下，不论一个主题内有多少消费者，一个消息只存储一次。</p>

<h3>消息持久化和缓存</h3>

<p>Kafka的持久化和缓存依赖于文件系统。对于硬盘来说，顺序读写的性能是随机读写性能
的10000倍，某些情况下顺序访问硬盘比随机访问内存要快。</p>

<p>现代操作系统都会为硬盘申请内存作为缓存。操作系统会倾向于将所有空闲的内存
分配给硬盘作为缓存，虽然这样会造成内存重新申请的性能损失。硬盘通过该缓冲区进行
读写，这个特性除非用直接的I/O操作，否则不会轻易被关闭。所以，即使一个进程缓存了
所有的数据，该数据也可能被复制进系统页缓存中，这样造成所有的东西被存储了2次</p>

<p>另外，基于JVM的应用对于内存的使用存在两个问题</p>

<ol>
<li>对象使用内存很高基本两倍于对象存储的内存</li>
<li>在堆内数据增长的时候，垃圾回收机制比较简单和消耗性能</li>
</ol>


<p>由于上面两点，利用文件系统缓存机制要优于直接利用内存缓存或类似机制。因此
kafka至少保持可用内存的两倍大小的缓存，如果需要存储压缩数据，则变成4倍大小
因此，对于一个32GB内存的机器，kafka会保持28-30GB的缓存，而不需要担心GC影响。
另外，一旦服务重启，这个缓存可以快速的重新载入，而进程内缓存需要在内存中重新申请
或者由代码进行初始化。所以这种机制简化了代码逻辑，对于内存和文件系统的同步
由操作系统完成。</p>

<p>基于以上，这种设计非常简单：不是在内存中保存数据，然后需要的时候flush进硬盘
，而是反过来，首先将所有数据写入文件系统的一个持久化日志中而不是由进程调用
flush数据操作。这意味着只要将数据写入内核页缓存中，然后给系统一个配置，多长
时间或者多大数据后将数据flush进硬盘中即可。</p>

<h3>恒定的时间消耗</h3>

<p>一般来说消息系统的元数据都是BTree存储的，虽然其可操作性强，时间开销是O(logN).
但是结合硬盘操作后，随机查找增多造成性能损耗严重。而日志系统的读取是顺序，
写入是直接在文件后进行添加，虽然比BTree没有更好的操作性，但是时间开销是O(1)
的，而且读取不会锁住写入操作或者彼此加锁。这样设计的一个显著优势是不再受数据大小的限制。
这样可以保存数据很长的时间，而不是一旦消息被分发就会被删除。</p>

<h3>效率优化手段</h3>

<p>假设消息量较大，但是对于每个发布的消息而言，消费的次数要大于生成的次数，因此
优化的手段在消费者更加有效。</p>

<p>两个影响性能的部分为</p>

<ul>
<li>大量的网络请求</li>
<li>多余的数据拷贝</li>
</ul>


<p>对于网络请求，根据消息特性进行分组，可以将同组消息打包为&#8221;message set&#8221;，每次
可以将多个消息打包后发送，而不是单独发送每个消息。对于MessageSet，接口简单
一般不需要进行序列化和反序列化</p>

<p>消息日志被broker保存其硬盘上。因此，即使单个字节的消息也可以被不同的brokeer和
consumer共享。</p>

<p>现代unix系统可以支持代码直接将页面缓存的数据直接发送给网络缓存，减少中间拷贝
次数。Linux中利用sendfile系统调用完成这个功能，Java提供了标准库调用FileChannel.transferTo
接口</p>

<p>一般来说对于通过socket发送系统中的数据需要通过以下几个步骤</p>

<ol>
<li>内核空间上，硬盘读取到页面缓存</li>
<li>用户空间读取内核空间的数据</li>
<li>在将数据从用户空间写入到内核空间的socket缓存</li>
<li>系统将socket缓存中的数据拷贝到NIC缓存中</li>
</ol>


<p>需要4此拷贝，2次系统调用。利用sendfile，可以直接将页面缓存拷贝到网络中，
因此只有第4步拷贝到NIC缓存中</p>

<p>对于同个主题的多个consumer，利用zero-copy技术，数据只需要拷贝到页面缓存中
一次，并且对于多个网络输出进行复用，因此速度基本可达网络硬件的上限。</p>

<h3>端到端的压缩</h3>

<p>某些时候，系统瓶颈不再于cpu而是网络能力。而由用户简单的将消息压缩后传送给
消息系统无法降低消息间的冗余，更有效的消息压缩应该是将一组消息进行压缩后传输，
更理想的是端到端的方式，数据传输前被压缩后通过producer传输给server，server
不解压直接传送给cosumer，然后由consumer进行解压。</p>

<p>kafka支持递归的消息集合。一组消息被打包后传输给server，然后这组消息被传输给
所有的consumer进行解压后处理。</p>

<h3>消费者状态</h3>

<h3>分布式</h3>

<h3>生产者</h3>

<h3>支持hadoop和其他数据载入</h3>

<h2>实现细节</h2>

<h3>API设计</h3>

<h3>网络层设计</h3>

<h3>消息设计及格式</h3>

<h3>日志</h3>

<h3>分布式</h3>

<h2>#</h2>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/09/slice-reading-0809/">Slice Reading 0809</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-09T14:23:00+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/09/slice-reading-0809/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>TimeTunel</h2>

<p>对现有日志的跟踪</p>

<ul>
<li>基于thrift</li>
<li>zookeeper做负载均衡以及分配</li>
<li>环状的broker的repulication</li>
</ul>


<h2>pytailer</h2>

<p><a href="https://github.com/six8/pytailer">pytailer</a></p>

<h2>Durable Event Data Transport at Scale</h2>

<p><a href="http://sharadag.tumblr.com/post/13549427326/durable-event-data-transport-at-scale">link</a></p>

<h2>Twitter Storm Transactional topologies</h2>

<p><a href="https://github.com/nathanmarz/storm/wiki/Transactional-topologies">Transactional topologies</a>
是关于Twitter Storm内部消息持久化的拓扑设计。</p>

<p><a href="http://xumingming.sinaapp.com/109/twitter-storm%E7%AE%80%E4%BB%8B/">chinese intro</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/09/zikpin-intro/">Zikpin Intro</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-09T11:31:00+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/09/zikpin-intro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>简介</h2>

<p>Zipkin是一个分布式的追踪系统，可以通过该系统获取各个服务的时间数据。Twitter用
它来管理信息收集以及查询服务组件。它的思想来源于<a href="http://research.google.com/pubs/pub36356.html">Google Dapper</a></p>

<p>对一个分布式系统进行跟踪监控的原因在于我们可以获取系统服务的深层次数据，比如
某个服务的响应时间，根据这点可以判断当前分布式系统的性能瓶颈以及其他信息。Zikpin
获取这些信息后通过浏览器显示在web上</p>

<p>其体系结构如下</p>

<p><img src="https://github.com/twitter/zipkin/raw/master/doc/architecture-0.png"></p>

<p>每个被追踪的消息在系统中传送时都带了一个追踪标识，zipkin通过该标识在追踪系统
中标记信息，判断时间。所有带有追踪标识的消息在被服务端传送出去时通过工具库将
该消息传送给zipkin系统。</p>

<p>{ % img https://github.com/twitter/zipkin/raw/master/doc/architecture-1.png % }</p>

<h2>组件</h2>

<p><strong>Finagle</strong></p>

<blockquote><p>这使一个基于JVM的异步网络框架，通过它可以创建异步RPC，任何基于JVM的语言都
可以用它来创建客户端/服务端</p></blockquote>

<p><em>Frinagle</em>在twitter中被广泛使用。可以在其上添加追踪功能，目前客户端和服务端均
支持Trift和HTTP协议，缓存部分只支持Memcache和Redis(So far we have client/server support for Thrift and HTTP as well as client only support for Memcache and Redis.)</p>

<p>初始化一个finagle server并绑定追踪服务</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ServerBuilder</span><span class="o">()</span>
</span><span class='line'>  <span class="o">.</span><span class="na">codec</span><span class="o">(</span><span class="n">ThriftServerFramedCodec</span><span class="o">())</span>
</span><span class='line'>    <span class="o">.</span><span class="na">bindTo</span><span class="o">(</span><span class="n">serverAddr</span><span class="o">)</span>
</span><span class='line'>    <span class="o">.</span><span class="na">name</span><span class="o">(</span><span class="s">&quot;servicename&quot;</span><span class="o">)</span>
</span><span class='line'>      <span class="o">.</span><span class="na">tracerFactory</span><span class="o">(</span><span class="n">ZipkinTracer</span><span class="o">())</span>
</span><span class='line'>        <span class="o">.</span><span class="na">build</span><span class="o">(</span><span class="k">new</span> <span class="n">SomeService</span><span class="o">.</span><span class="na">FinagledService</span><span class="o">(</span><span class="n">queryService</span><span class="o">,</span> <span class="k">new</span> <span class="n">TBinaryProtocol</span><span class="o">.</span><span class="na">Factory</span><span class="o">()))</span>
</span></code></pre></td></tr></table></div></figure>


<p>初始化一个客户端类似上面的操作，一旦指定Zipkin为追踪服务，那么请求在开始和
结束的时候被自动追踪，相应的服务和机器也会被同时记录。</p>

<p>可以自定义添加更多的追踪信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Trace</span><span class="o">.</span><span class="na">record</span><span class="o">(</span><span class="s">&quot;starting that extremely expensive computation&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>除了字符串也可以添加key-value信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Trace</span><span class="o">.</span><span class="na">recordBinary</span><span class="o">(</span><span class="s">&quot;http.response.code&quot;</span><span class="o">,</span> <span class="s">&quot;500&quot;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Ruby Thrift</strong></p>

<p>利用一个gem追踪请求，可以用里面的RackHandler生成id，并通知追踪系统该id。下面
是一个ruby thrift client的例子</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="no">ThriftClient</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">SomeService</span><span class="o">::</span><span class="no">Client</span><span class="p">,</span> <span class="s2">&quot;127.0.0.1:1234&quot;</span><span class="p">)</span>
</span><span class='line'><span class="n">client_id</span> <span class="o">=</span> <span class="no">FinagleThrift</span><span class="o">::</span><span class="no">ClientId</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;service_example.sample_environment&quot;</span><span class="p">)</span>
</span><span class='line'><span class="no">FinagleThrift</span><span class="o">.</span><span class="n">enable_tracing!</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">client_id</span><span class="p">),</span> <span class="s2">&quot;service_name&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Querulous</strong></p>

<p>是一个一个SQL的接口库，基于Scala实现</p>

<p><strong>Cassie</strong></p>

<p>是一个Finagle内部的基于Cassandra client库的实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">cluster</span><span class="o">.</span><span class="na">keyspace</span><span class="o">(</span><span class="n">keyspace</span><span class="o">).</span><span class="na">tracerFactory</span><span class="o">(</span><span class="n">ZipkinTracer</span><span class="o">())</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Transport</strong></p>

<p>利用Scribe作为传输模块，利用该模块可以将服务的追踪信息传输给zipkin和hadoop。</p>

<blockquote><p>Scribe已经停止开发了，是否有替换？</p></blockquote>

<p><strong>Zipkin collector daemon</strong></p>

<p>信息收集器，一旦追踪信息传送到收集器，该模块会判断其有效性，存储并索引它。</p>

<p><strong>Storage</strong></p>

<p>存储模块，现在是利用Cassandra实现。可以选择不同的存储方式</p>

<blockquote><p>比如HBase?</p></blockquote>

<p><strong>Zipkin query daemon</strong></p>

<p>查询模块，通过简单的Trift api查找追踪存储后的信息</p>

<p><strong>UI</strong></p>

<p>显示追踪信息，该模块是一个利用D3的Rails应用</p>

<p>模块间关系如下：</p>

<p><img src="https://github.com/twitter/zipkin/raw/master/doc/modules.png"></p>

<h2>安装配置</h2>

<h3>Cassandra</h3>

<pre><code>利用下面的命令链接当前工程
```bash
bin/cassandra-cli -host localhost -port 9160 -f zipkin-server/src/schema/cassandra-schema.txt
```
</code></pre>

<h3>Zookeeper</h3>

<h3>Scribe</h3>

<pre><code>Scribe配置如下

```xml
&lt;store&gt;
  category=zipkin
    type=network
      remote_host=123.123.123.123
        remote_port=9410
          use_conn_pool=yes
            default_max_msg_before_reconnect=50000
              allowable_delta_before_reconnect=12500
                must_succeed=no
                &lt;/store&gt;
```
</code></pre>

<h3>Zipkin server</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git clone https://github.com/twitter/zipkin.git
</span><span class='line'><span class="nb">cd </span>zipkin
</span><span class='line'>cp zipkin-scribe/config/collector-dev.scala zipkin-scribe/config/collector-prod.scala
</span><span class='line'>cp zipkin-server/config/query-dev.scala zipkin-server/config/query-prod.scala
</span><span class='line'>Modify the configs above as needed. Pay particular attention to ZooKeeper and Cassandra server entries.
</span><span class='line'>bin/sbt update package-dist <span class="o">(</span>This downloads SBT 0.11.2 <span class="k">if </span>it doesn<span class="err">&#39;</span>t already exist<span class="o">)</span>
</span><span class='line'>scp dist/zipkin*.zip <span class="o">[</span>server<span class="o">]</span>
</span><span class='line'>ssh <span class="o">[</span>server<span class="o">]</span>
</span><span class='line'>unzip zipkin*.zip
</span><span class='line'>mkdir -p /var/log/zipkin
</span><span class='line'>zipkin-scribe/scripts/collector.sh -f zipkin-scribe/config/collector-prod.scala
</span><span class='line'>zipkin-server/scripts/query.sh -f zipkin-server/config/query-prod.scala
</span></code></pre></td></tr></table></div></figure>


<h3>Zipkin UI</h3>

<p>是一个标准的Rails 3应用</p>

<ol>
<li>升级Zookeeper server的配置。用来定位查询器</li>
<li>发布到何时的Rail 3 server上</li>
</ol>


<p><strong>zipkin-tracer gem</strong></p>

<p>通过Rack Handler在Rails 应用中添加追踪信息，在 config.ru中</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">use</span> <span class="no">ZipkinTracer</span><span class="o">::</span><span class="no">RackHandler</span>
</span><span class='line'>  <span class="n">run</span> <span class="o">&lt;</span><span class="no">YOUR_APPLICATION</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>运行一个简单的Hadoop任务</h2>

<p>如果设置Scribe存储到Hadoop上，会产生一系列难以操作数据的报告。因此，利用一个
<a href="http://github.com/twitter/scalding">Scalding</a>来写Hadoop任务</p>

<ol>
<li><p>要运行hadooop任务，需要生成一个全包含的jar包</p>

<p> <code>
 sbt 'project zipkin-hadoop' compile assemble
</code></p></li>
<li><p>修改scald.rb指向需要运行hadoop任务的机器名</p></li>
<li><p>如果需要，升级scald.rb中的jarfile的版本</p></li>
<li><p>通过scald.rb脚本运行hadoop任务</p>

<p> <code>bash
 ./scald.rb --hdfs com.twitter.zipkin.hadoop.[classname] --date yyyy-mm-ddThh:mm yyyy-mm-ddThh:mm --output [dir]
</code></p></li>
</ol>


<h2>Google论文笔记</h2>

<p><a href="http://research.google.com/pubs/pub36356.html">Google Dapper</a>是google发表于2010年的一篇关于分布式服务监控以及查询的论文</p>

<h3>目的</h3>

<h3>方式</h3>

<h3>跟随者</h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/09/interview-100-pro/">Interview 100 Pro</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-09T11:00:00+08:00" pubdate data-updated="true">Aug 9<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/09/interview-100-pro/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>简述</h2>

<p>下面是关于程序员面试100题的相关笔记。不全面但是自己可以供参考</p>

<h2>题目</h2>

<h3>题目1</h3>

<p><em>输入一棵二元查找树,将该二元查找树转换成一个排序的双向链表。要求不能创建任何
新的结点,只调整指针的指向</em></p>

<p><strong>方案1</strong>
先完成左子树的转换，链接中间节点后，再完成右子树的转换，然后链接中间节点和右子树</p>

<p><strong>方案2</strong>
中序遍历</p>

<p><strong>注</strong>
中序遍历的算法</p>

<h3>题目2</h3>

<p><em>定义栈的数据结构,要求添加一个 min 函数,能够得到栈的最小元素。要求函数 min、push 以及
pop 的时间复杂度都是 O(1)</em></p>

<p><strong>解析</strong></p>

<p><strong>方案</strong></p>

<p><strong>注</strong></p>

<h3>题目3</h3>

<p><em>输入一个整形数组,数组里有正数也有负数。数组中连续的一个或多个整数组成一个子数组,每个
子数组都有一个和。求所有子数组的和的最大值。要求时间复杂度为 O(n)</em></p>

<p><strong>解析</strong></p>

<p><strong>方案</strong></p>

<p><strong>注</strong></p>

<h3>题目4</h3>

<h3>题目11</h3>

<p><em>输入一颗二元查找树,将该树转换为它的镜像,即在转换后的二元查找树中,左子树的结点都大于
右子树的结点。用递归和循环两种方法完成树的镜像转换</em></p>

<p><strong>解析</strong></p>

<p>对于递归，类似递归遍历方式，在递归前交换左右子树；至于非递归，可以用循环可以用一个栈
来模拟递归操作。</p>

<h3>题目12</h3>

<p><em>输入一颗二元树,从上往下按层打印树的每个结点,同一层中按照从左往右的顺序打印</em></p>

<p><em>解析</em></p>

<p>就是用队列层次遍历</p>

<h3>题目13</h3>

<p><em>在一个字符串中找到第一个只出现一次的字符。如输入 abaccdeff,则输出 b</em></p>

<p><em>解析</em></p>

<p>简单来说O(n<sup>2)的依次比较。可以用哈希。类似的题目，找出相同的字符，相同字符</sup>
的次数，出现次数最多的字符。在一个巨大的文件内出现次数最多的k个成员等等</p>

<h3>题目14</h3>

<p><em>n 个数字(0,1,&#8230;,n-1)形成一个圆圈,从数字 0 开始,每次从这个圆圈中删除第 m 个数字(第一个
为当前数字本身,第二个为当前数字的下一个数字)
。当一个数字删除后,从被删除数字的下一个继续删除
第 m 个数字。求出在这个圆圈中剩下的最后一个数字</em></p>

<p><em>解析</em></p>

<p>约瑟夫问题，可以直接用stl::list模拟行为，然后直接操作。或者利用推导完成递归公式。</p>

<h3>题目15</h3>

<p>关于类中的深浅拷贝问题，需要自定义拷贝构造函数以及重载等号，另外为了避免指针
被外面别的类删除，可以考虑用引用计数的方式</p>

<h3>题目16</h3>

<p><em>用最快的方法求fibonacci数列的第 n 项</em></p>

<p><em>解析</em></p>

<p>由于递归会重复计算很多次相同的值，那么可以考虑从0到n的计算，这样可以省去重复的
次数，复杂度是o(n)</p>

<p>可以有利用数学归纳发发现log(n)的算法</p>

<h3>题目17</h3>

<p><em>输入一个表示整数的字符串,把该字符串转换成整数并输出。例如输入字符串&#8221;345&#8221;,则输出整数
345</em></p>

<p><em>解析</em></p>

<p>问题不难，在c/c++ java python中都有现成的方法，但是大都不够严谨全面。</p>

<p>可以考虑用一个全局变量来标识是否输入合法，标准c中的atoi就是这样做的。</p>

<h3>题目18</h3>

<p><em>-用两个栈实现队列</em></p>

<p><em>解析</em></p>

<p>一个栈出一个栈入，出栈非空一直出，空则将入栈内的数据导入其中</p>

<p><em>注</em></p>

<p>如何用两个队列实现一个栈，可以考虑n个数先入一个队列，一旦要出的话，将前n-1个都
出队，然后入队进另一个队列。每次操作都如此</p>

<h3>题目19</h3>

<p><em>输入一个链表的头结点,反转该链表,并返回反转后链表的头结点</em></p>

<p>需要保存反转节点的子节点</p>

<h3>题目20</h3>

<p><em>如果字符串一的所有字符按其在字符串中的顺序出现在另外一个字符串二中,则字符串一称之为字
符串二的子串。注意,并不要求子串(字符串一)的字符必须连续出现在字符串二中。请编写一个函数,
输入两个字符串,求它们的最长公共子串,并打印出最长公共子串。
例如:输入两个字符串 BDCABA 和 ABCBDAB,字符串 BCBA 和 BDAB 都是是它们的最长公共子串,则
输出它们的长度 4,并打印任意一个子串</em></p>

<p><em>解析</em></p>

<p>经典的动态规划问题。</p>

<h3>题目 26</h3>

<p><em>输入一个正数 n,输出所有和为 n 连续正数序列</em></p>

<p>类似10题</p>

<h3>27</h3>

<p><em>输入一棵二元树的根结点,求该树的深度。从根结点到叶结点依次经过的结点(含根、叶结点)形成树的一条路径,最长路径的长度为树的深度</em></p>

<p>递归遍历二叉树</p>

<h3>28</h3>

<p>递归的考察</p>

<p>似乎穷举和动态规划的方式</p>

<p>值得深入思考下</p>

<h3>29</h3>

<p><em>输入一个整数数组,调整数组中数字的顺序,使得所有奇数位于数组的前半部分,所有偶数位于数
组的后半部分。要求时间复杂度为 O(n)</em></p>

<p>和快速排序类似，但是这个比较的时候不是比较大小，而是除以2看余数是否为0</p>

<p>值得注意的是结构的安排和算法不同部分的解耦</p>

<h3>30</h3>

<p><em>给出如下 CMyString 的声明,要求为该类型添加赋值运算符函数</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="k">class</span> <span class="nc">CMyString</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span><span class="o">:</span>
</span><span class='line'>  <span class="n">CMyString</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">pData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'>  <span class="n">CMyString</span><span class="p">(</span><span class="k">const</span> <span class="n">CMyString</span><span class="o">&amp;</span> <span class="n">str</span><span class="p">);</span>
</span><span class='line'>  <span class="o">~</span><span class="n">CMyString</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span class='line'>  <span class="k">private</span><span class="o">:</span>
</span><span class='line'>  <span class="kt">char</span><span class="o">*</span> <span class="n">m_pData</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>除了需要注意的4点外，能够更好的设计结构，利用析构函数更好</p>

<h3>31</h3>

<p><em>输入一个链表的头结点,从尾到头反过来输出每个结点的值。链表结点定义如下</em></p>

<p>me:顺序访问，然后用个栈</p>

<p>解析:</p>

<p>可以用递归，也是用栈，但是是在函数层次的栈</p>

<h3>32</h3>

<p><em>用 C++设计一个不能被继承的类。</em></p>

<p>me: 固定类大小，静态类？</p>

<p>解析：</p>

<p>构造和析构私有</p>

<p>利用模板和虚继承</p>

<h3>33</h3>

<p><em>给定链表的头指针和一个结点指针,在 O(1)时间删除该结点</em></p>

<p>me:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="n">phead</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">=</span><span class="n">pdelete</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
</span><span class='line'><span class="n">ptr</span> <span class="o">=</span> <span class="n">phead</span><span class="p">;</span>
</span><span class='line'><span class="n">phead</span><span class="o">=</span><span class="n">phead</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span><span class='line'><span class="k">delete</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>解析：</p>

<p>们需要需要把给定的结点的下一个结点的数据拷
贝到给定的结点中</p>

<h3>34</h3>

<p><em>一个整型数组里除了两个数字之外,其他的数字都出现了两次。请写程序找出这两个
只出现一次的数字。要求时间复杂度是 O(n) ,空间复杂度是 O(1)</em></p>

<p>me: 类似bit排序，扫描放入，但是空间复杂度是o(n)</p>

<p>解析：</p>

<p>如果一个数组中只有一个出现一次，其他出现两次，连续异或后只剩下出现一次的数字</p>

<p>(me: 首先连续异或，然后用异或后的数字分别异或所有的值能够出现在数组内的两个值就是)</p>

<p>我们在结果数字中找到第一个为 1 的位的位置,记为第 N 位。现在我们以第
N 位是不是 1 为标准把原数组中的数字分成两个子数组,第一个子数组中每个数字的第 N
位都为 1,而第二个子数组的每个数字的第 N 位都为 0</p>

<h3>35</h3>

<p><em>两个单向链表,找出它们的第一个公共结点</em></p>

<p>me: 组成两个环，一个每次步进1，一个每次步进2，相遇的那一点</p>

<p>可能会遇到后面的公共点</p>

<p>解析：</p>

<p>我们先要分别遍历两个链表得到它们的长度,并求出两个长度之差。在长的
链表上先遍历若干次之后,再同步遍历两个链表,知道找到相同的结点</p>

<h2>#</h2>

<h2>参考</h2>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/08/mongodbquan-wei-zhi-nan-notes/">Mongodb权威指南 Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-08T14:42:00+08:00" pubdate data-updated="true">Aug 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/08/mongodbquan-wei-zhi-nan-notes/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>入门</h2>

<ul>
<li>文档是数据的基本单元</li>
<li>具有javascript shell</li>
<li>单个实例可以容纳多个独立数据库</li>
</ul>


<h3>文档</h3>

<p>javascript中文档表现为对象</p>

<p>区分类型且区分大小写</p>

<p>文档中不能有重复的键</p>

<h3>集合</h3>

<p>集合就是一组文档。</p>

<p>集合是无模式的</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/08/mongodb-simple/">MongoDB Simple</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-08T14:23:00+08:00" pubdate data-updated="true">Aug 8<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/08/mongodb-simple/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>简介</h2>

<ul>
<li><p>拓展了关系数据库的功能，比如辅助索引，范围查询以及排序</p></li>
<li><p>内置MapReduce的支持</p></li>
<li><p>文档丰富，接口友好</p></li>
<li><p>MongoDB是一个面向文档的数据库。</p></li>
<li><p>没有模式</p></li>
<li><p>易于扩展</p></li>
<li><p>速度快</p></li>
<li><p>管理方便</p></li>
</ul>


<h2>简单安装和运行</h2>

<ol>
<li>直接下载二进制包</li>
<li>在根目录创建/data/db/目录</li>
<li>运行bin/mongod</li>
</ol>


<p>on Ubuntu</p>

<p>设置GPG key</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
</span></code></pre></td></tr></table></div></figure>


<p>在/etc/apt/sources.list.d/中创建10gen.list添加如下行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen
</span></code></pre></td></tr></table></div></figure>


<p>然后运行</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install mongodb-10gen
</span></code></pre></td></tr></table></div></figure>


<h2>设置</h2>

<p>配置文件在/etc/mongodb.conf</p>

<h2>教程</h2>

<p>在其官方网站<a href="http://www.mongodb.org/">Mongodb</a>上有一个Try it out的教程</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/07/slice-reading-0807/">Slice Reading 0807</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-07T18:04:00+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/07/slice-reading-0807/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>SPDY协议特点</h2>

<ul>
<li>多路复用，请求优化</li>
<li>服务器推送</li>
<li>HTTP头压缩</li>
<li>强制SSL</li>
</ul>


<p><a href="http://www.scriptlover.com/static/1739-spdy-web-%E5%89%8D%E7%AB%AF">SPYD</a></p>

<h2>WebSocket</h2>

<p>客户端在HTTP协议中加入特殊的tag，服务端识别后与其建立长链接，服务端可以通过该链接主动推送内容到客户端上。</p>

<h2>webdriver</h2>

<p><a href="http://www.infoq.com/cn/news/2011/06/selenium-arch">开源应用架构之​Selenium WebDriver（上)</a></p>

<p><a href="http://code.google.com/p/chromedriver/">ChromeDriver</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/07/apache-mina-with-spring/">Apache Mina With Spring</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-07T14:12:00+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/07/apache-mina-with-spring/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content">
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/07/springru-men-dao-jing-tong-bi-ji/">Spring入门到精通笔记</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-07T11:00:00+08:00" pubdate data-updated="true">Aug 7<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/07/springru-men-dao-jing-tong-bi-ji/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>概述</h2>

<p>模块划分</p>

<ul>
<li>核心是控制反转，通过配置文件完成业务对象间的依赖注入。</li>
<li>提供事物处理功能</li>
<li>简单有效的JDBC应用</li>
<li>强大灵活的Web框架</li>
</ul>


<p>特点</p>

<ul>
<li>良好的分层</li>
<li>以IOC为核心，促使开发人员面向接口编程</li>
<li>良好架构设计</li>
<li>代替EJB</li>
<li>MVC代替MVC2</li>
<li>和Struts, Hibernate结合</li>
</ul>


<h2>安装</h2>

<p><strong>安装Eclipse及插件</strong></p>

<p>下载eclipse安装</p>

<p>Help->Install New Software
添加插件库
http://download.eclipse.org/webtools/repository/indigo/
然后进行安装</p>

<p><strong>ubuntu安装tomcat</strong></p>

<p><strong>设置eclipse及tomcat</strong></p>

<p><a href="https://github.com/openplans/OpenTripPlanner/wiki/SettingUpATomcatServerInEclipse">Setting up a Tomcat server in Eclipse</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo apt-get install tomcat7
</span><span class='line'><span class="nb">cd</span> /usr/share/tomcat7
</span><span class='line'>sudo ln -s /var/lib/tomcat7/conf conf
</span><span class='line'>sudo ln -s /etc/tomcat7/policy.d/03catalina.policy conf/catalina.policy
</span><span class='line'>sudo ln -s /var/log/tomcat7 log
</span><span class='line'>sudo chmod -R 777 /usr/share/tomcat7/conf
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://help.ubuntu.com/12.04/serverguide/tomcat.html">Installation</a></p>

<p><a href="https://github.com/openplans/OpenTripPlanner/wiki/SettingUpATomcatServerInEclipse">Config with Eclipse</a></p>

<h2>HelloWorld</h2>

<h3>基础例子</h3>

<p><strong>创建工程</strong></p>

<p>创建一个java工程</p>

<p><strong>添加依赖库</strong></p>

<p>需要在build path中添加</p>

<ul>
<li>commons-logging-1.1.1.jar</li>
<li>log4j-1.2.16.jar</li>
<li>slf4j-api-1.6.1.jar</li>
<li>slf4j-log4j12-1.6.4.jar</li>
<li>spring-asm-3.2.0.M1.jar</li>
<li>spring-beans-3.2.0.M1.jar</li>
<li>spring-context-3.2.0.M1.jar</li>
<li>spring-core-3.2.0.M1.jar</li>
<li>spring-expression-3.2.0.M1.jar</li>
</ul>


<p><strong>添加代码</strong></p>

<figure class='code'><figcaption><span>HelloWorld.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>TestHello.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.context.support.FileSystemXmlApplicationContext</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">Hello.HelloWorld</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestHello</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
</span><span class='line'>      <span class="n">ApplicationContext</span> <span class="n">helloContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemXmlApplicationContext</span><span class="o">(</span>
</span><span class='line'>              <span class="s">&quot;config.xml&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">HelloWorld</span> <span class="n">hw</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloWorld</span><span class="o">)</span><span class="n">helloContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;HelloWorld&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>配置log4j以及config.xml</strong></p>

<figure class='code'><figcaption><span>log4j.properties</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>log4j.rootLogger=DEBUG, A1
</span><span class='line'>log4j.appender.A1=org.apache.log4j.ConsoleAppender
</span><span class='line'>log4j.appender.A1.layout=org.apache.log4j.PatternLayout
</span><span class='line'>log4j.appender.A1.layout.ConversionPattern=%-4r %-5p [%t] %37c %3x - %m%n
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>config.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;</span>
</span><span class='line'><span class="cp">&quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;beans&gt;</span>
</span><span class='line'>  <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;HelloWorld&quot;</span> <span class="na">class=</span><span class="s">&quot;Hello.HelloWorld&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;msg&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>          <span class="nt">&lt;value&gt;</span>HelloWorld<span class="nt">&lt;/value&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/property&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/bean&gt;</span>
</span><span class='line'><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中</p>

<ul>
<li><em>id</em>      唯一标识bean</li>
<li><em>class</em>   标识bean来源</li>
<li><em>msg</em>     和<value>一起定义注入字符串，注意setAttr/getAttr的名称定义，参见 <a href="http://blog.csdn.net/yunye114105/article/details/7364264">Java Bean 属性命名规范问题分析</a></li>
</ul>


<h3>改写例子</h3>

<p>定义接口</p>

<figure class='code'><figcaption><span>HelloInter.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HelloInter</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">public</span> <span class="n">String</span> <span class="nf">doSalutation</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>实现EnHello和CnHello</p>

<figure class='code'><figcaption><span>ChHello.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ChHello</span> <span class="kd">implements</span> <span class="n">HelloInter</span><span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">doSalutation</span><span class="o">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;你好&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>EnHello.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnHello</span> <span class="kd">implements</span> <span class="n">HelloInter</span><span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">){</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">s</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">doSalutation</span><span class="o">(){</span>
</span><span class='line'>      <span class="k">return</span> <span class="s">&quot;Welcome&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">msg</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>更新TestHello</p>

<figure class='code'><figcaption><span>TestHello.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">Hello</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestHello</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
</span><span class='line'>      <span class="n">ApplicationContext</span> <span class="n">helloContext</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileSystemXmlApplicationContext</span><span class="o">(</span>
</span><span class='line'>              <span class="s">&quot;config.xml&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">HelloWorld</span> <span class="n">hw</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloWorld</span><span class="o">)</span><span class="n">helloContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;HelloWorld&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hw</span><span class="o">.</span><span class="na">getMsg</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;\n============\n&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">HelloInter</span> <span class="n">ch</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloInter</span><span class="o">)</span><span class="n">helloContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;CnHello&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ch</span><span class="o">.</span><span class="na">doSalutation</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;\n============\n&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">HelloInter</span> <span class="n">eh</span> <span class="o">=</span> <span class="o">(</span><span class="n">HelloInter</span><span class="o">)</span><span class="n">helloContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&quot;EnHello&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">eh</span><span class="o">.</span><span class="na">doSalutation</span><span class="o">());</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>修改config.xml</p>

<figure class='code'><figcaption><span>config.xml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
</span><span class='line'><span class="cp">&lt;!DOCTYPE beans PUBLIC &quot;-//SPRING//DTD BEAN//EN&quot;</span>
</span><span class='line'><span class="cp">&quot;http://www.springframework.org/dtd/spring-beans.dtd&quot;&gt;</span>
</span><span class='line'><span class="nt">&lt;beans&gt;</span>
</span><span class='line'><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;HelloWorld&quot;</span> <span class="na">class=</span><span class="s">&quot;Hello.HelloWorld&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;msg&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;value&gt;</span>HelloWorld<span class="nt">&lt;/value&gt;</span>
</span><span class='line'><span class="nt">&lt;/property&gt;</span>
</span><span class='line'><span class="nt">&lt;/bean&gt;</span>
</span><span class='line'><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;CnHello&quot;</span> <span class="na">class=</span><span class="s">&quot;Hello.ChHello&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;msg&quot;</span> <span class="na">value=</span><span class="s">&#39;嗨&#39;</span><span class="nt">&gt;&lt;/property&gt;&lt;/bean&gt;</span>
</span><span class='line'><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;EnHello&quot;</span> <span class="na">class=</span><span class="s">&quot;Hello.EnHello&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;msg&quot;</span> <span class="na">value=</span><span class="s">&quot;Hi&quot;</span><span class="nt">&gt;&lt;/property&gt;&lt;/bean&gt;</span>
</span><span class='line'><span class="nt">&lt;/beans&gt;</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/08/06/ri-zhi-xi-tong-bi-jiao/">日志系统比较</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-08-06T17:52:00+08:00" pubdate data-updated="true">Aug 6<span>th</span>, 2012</time>
        
         | <a href="/blog/2012/08/06/ri-zhi-xi-tong-bi-jiao/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>相关文档及消息</h2>

<ul>
<li><a href="http://www.chinaovo.net/scribe/287.htm">开源日志系统比较</a></li>
<li><a href="http://www.quora.com/Scribe/Is-Scribe-still-maintained">Scribe stop developping</a></li>
<li><a href="git://github.com/twitter/zipkin.git">zipkin twitter的查询系统</a></li>
<li><a href="http://www.quora.com/How-does-Facebooks-Puma-guarantee-messages-wont-lost-during-processing">How does Facebook&#8217;s Puma quarantee message won&#8217;t lost during processing</a></li>
<li><a href="http://www.quora.com/Sam-Rash">facebook engineer</a></li>
<li><a href="http://www.quora.com/Why-did-Facebook-develop-Puma-pTail-instead-of-using-existing-ones-like-Flume/answer/Sam-Rash">Why did Facebook develop Puma/pTail instead of using existing ones like Flume ?</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/16/apache-nutch-and-solr-chu-shi/">Apache Nutch and Solr 初试</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/14/using-cppcheck/">using cppcheck</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/07/google-python-style/">Google Python Style</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/25/ubuntu-sudo-wu-mi-ma/">Ubuntu sudo 无密码</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/12/24/keepalivedshi-yong/">Keepalived使用</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - windfire.cd -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'windfire-cd-comments';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
